# note分析 Basic v7 仕様書 (2025/12/28)

## 1. 概要
noteの公式統計APIからデータを取得し、自身の記事のパフォーマンスを可視化するStreamlitアプリケーション。
「知識がある人向けのローカル実行」および「知識がない人向けのRenderデプロイ」の両方に対応する。

## 2. システム構成
- **言語**: Python 3.10+
- **フレームワーク**: Streamlit
- **データベース**: 
    - ローカル：SQLite (`note_dashboard.db`)
    - クラウド：Neon (PostgreSQL)
- **主なライブラリ**: pandas, plotly, requests, psycopg2-binary, python-dotenv, stripe

## 3. 主要機能
### 3.1 認証・取得
- **note認証**: メールアドレスとパスワードによるログイン。パスワードはDBに保存せず、メモリ上でのみ保持される。
- **統計取得**: 統計API（累計PV/スキ/コメント）の全件取得。
- **重複排除**: (user_id, acquired_at, article_id) による一意性確保。

### 3.2 データ表示（ダッシュボード）
- **サマリー**: 公開記事数、累計総ビュー数（前回比付き）、累計総スキ数。
- **全体累計ビュー推移**: 全記事合計の折れ線グラフ。
- **ランキング**: 累計ランキング、および「本日の伸び」ランキング。
- **個別推移**: 各記事ごとの詳細推移（ホバー詳細付き）。

### 3.3 収益化・自動承認 (Cloudモードのみ)
- **Stripe連携**: 月額300円のサブスクリプション制。
- **全自動同期**: ログインのたびにStripe APIで支払い状況を確認。有効な期間中（無料トライアル含む）のみ自動でアクセスを許可。
- **クーポン対応**: `FREE30` (初月無料) 等のプロモーションコードに対応。

## 4. セキュリティとプライバシー
- **パスワード非保持**: noteのパスワードは一切データベースに保存しない設計。
- **データ分離**: 暗号化された `user_id` により、同一テーブル内でも他人のデータは閲覧不能。
- **管理者権限**: `ADMIN_EMAIL` 設定者のみユーザー削除・一覧閲覧が可能。

## 5. 実行モード
### 5.1 ローカル配布モード
- **DATABASE_URL未設定**: ログイン画面やStripe案内をスキップし、直接ダッシュボードを表示。
### 5.2 クラウド運用モード
- **DATABASE_URL設定済み**: アプリ独自のログイン・登録およびStripe決済が必須となるSaaS形態。